'use strict';

const net = require('net');
const http = require("http");

let count = 0;

const server = http.createServer(function(req, res) {
  const id = count++;
  setTimeout(function() {
    res.end('hello');
  }, (2 - id) * 1000);

  if (id === 1)
    server.close();
});

server.listen(8080, function() {
  const host = server.address().address;
  const port = server.address().port;


  console.log('Example app (' + process.pid + ') listening at http://%s:%s', host, port);

  const s = net.connect(port);

  const req = 'GET / HTTP/1.1\nConnection: keep-alive\n\n';
  const big = req + req;
  s.end(big);
  s.resume();
});
